
// Job paramaters to set for this environment

params.outdir = "output" 

// Software locations

params.metaphlan = "/ifs/data/nfs_share/ikmb_repository/software/metaphlan/2.0/metaphlan2.py"
params.metaphlan_pkl = "/ifs/data/nfs_share/ikmb_repository/databases/Metaphlan/2.0/mpa_v20_m200.pkl"
params.metaphlan_db = "/ifs/data/nfs_share/ikmb_repository/databases/Metaphlan/2.0/mpa_v20_m200"

params.fastqc = "/ifs/data/nfs_share/ikmb_repository/software/fastqc/0.11.3/fastqc"

params.pathoscope = "/ifs/data/nfs_share/ikmb_repository/software/pathoscope/2.0.6/pathoscope/pathoscope2.py"
params.pathoscope_index_dir = "/ifs/data/nfs_share/ikmb_repository/databases/Pathoscope/2015-06"

params.trimmomatic = "/ifs/data/nfs_share/ikmb_repository/software/trimmomatic/0.36"

// Trimmomatic configuration variables
params.leading = 3
params.trailing = 3
params.slidingwindow = "4:15"
params.minlen = 75
params.adapters = "NexteraPE-PE.fa"


// Resource manager settings

executor {
  name="slurm"
  queueSize=50
}

// Process setting

process {

  // Global cluster parameters
  executor = 'slurm'
  queue = 'ikmb_a'
  clusterOptions = { '--qos=ikmb_a' }
  memory = { 8.GB * task.attempt }
  cpus = { 1 * task.attempt }
  time = { 2.h * task.attempt }
  errorStrategy = { task.exitStatus == 143 ? 'retry' : 'finish' }
  maxRetries = 3
  maxErrors = '-1'
 
  // Specific cluster parameters for each process

  $Merge {
	time = { 3.h * task.attempt }
  }

  $Fastqc {
   	module = [ "Java/1.8.0", "Fastqc/0.11.3" ]

  }
	
  $runMultiQCFastq {
	module = [ 'Python/2.7.10' ]
  }

  $Trimmomatic {
  	module = [ 'Java/1.8.0' ]
	cpus = 8
        memory = { 16.GB * task.attempt }
  }

  $runPathoscopeMap {
  	module = [ 'Python/2.7.10', 'Samtools/0.1.19', 'Bowtie2/2.2.3', 'Pathoscope/2.0.6' ]
	cpus = 8
        memory = { 32.GB * task.attempt }
	time = { 3.h * task.attempt }
  }

  $runPathoscopeId {
  	module = [ 'Python/2.7.10', 'Samtools/0.1.19', 'Bowtie2/2.2.3', 'Pathoscope/2.0.6' ]
	time = { 3.h * task.attempt }
  }

  $runMetaphlan {
 	module = [ 'Python/2.7.10', 'Bowtie2/2.2.3', 'Metaphlan/2.0' ]
	cpus = 8
	memory = { 32.GB * task.attempt }
	time = { 3.h * task.attempt }
  }


}
